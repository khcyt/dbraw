const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof kh_global.window&&"undefined"===typeof kh_global.process&&kh_global.self;const cf="kh_components";const mf="kh_components_resizable_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof kh_global.window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof kh_global.process?"node.js":"undefined"!==typeof kh_global.self?kh_global.self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);import{isValid}from"/contrib/jsm/kh_earlybird.js";import{EnumValue,JSON8MergePatch,Error}from"/contrib/jsm/kh_classes.js";import{getRandomArbitrary}from"/contrib/jsm/kh_functions.js";const name=MF`${mf}`;const print_level=undefined;import{Logger}from"/contrib/jsm/kh_log.js";const kh_log=new Logger(print_level,()=>name);import{vjs,Rect}from"/contrib/jsm/kh_vanilla.js";import*as vjs2 from"/contrib/jsm/kh_vanilla2.js";Object.assign(vjs,{...vjs2});import{Component}from"/contrib/jsm/kh_components_base.js";export const resizeDirection=Object.freeze({rD_n:new EnumValue("north",1<<0>>>0),rD_ne:new EnumValue("north-east",1<<1>>>0),rD_e:new EnumValue("east",1<<2>>>0),rD_se:new EnumValue("south-east",1<<3>>>0),rD_s:new EnumValue("south",1<<4>>>0),rD_sw:new EnumValue("south-west",1<<5>>>0),rD_w:new EnumValue("west",1<<6>>>0),rD_nw:new EnumValue("north-west",1<<7>>>0),valueOf:(obj,rD)=>EnumValue.valueOf(obj,rD,resizeDirection),map(rD){return EnumValue.map(rD,resizeDirection)}});class ResizableComponent extends Component{static flag="resizable";base(component_base){if(isValid(component_base)&&!(component_base instanceof Resizable))throw new Error({msg:["invalid-argument","resizable",arguments[0]]});return super.base(component_base)}}export class Resizable extends ResizableComponent{#id_=getRandomArbitrary()|0;#ns_=`${mf}.${this.#id_}`;#options_;#Șdom_;static#def_classes_={resizable:"kh-rsz-element",wrapper:"kh-rsz-wrapper",handle_stem:"kh-rsz-"};constructor(resizable_element_or_selector,{classes=Resizable.#def_classes_,direction=resizeDirection.rD_se,maxWidth=-1,maxHeight=-1,must_wrap=false}){super();this.#options_=JSON8MergePatch.apply(JSON8MergePatch.apply({classes:Resizable.#def_classes_},{classes,direction,maxWidth,maxHeight,must_wrap}),arguments[1]??{});resizable_element_or_selector=vjs(resizable_element_or_selector,true)?.[0];if(!isValid(resizable_element_or_selector))throw new Error({msg:["invalid-argument","resizable_element"]});if(true===this.options.must_wrap){const style=vjs.style(resizable_element_or_selector,{position:undefined,top:undefined,left:undefined,bottom:undefined,right:undefined,border:undefined,maxWidth:undefined,minWidth:undefined,maxHeight:undefined,minHeight:undefined,width:undefined,height:undefined,zIndex:undefined,"--rsz-handle-color":undefined});if(!isValid(style.height)||"auto"==style.height){style.height=`${resizable_element_or_selector.clientHeight}px`}const wrapper=vjs.div({style,class:this.options.classes.wrapper});resizable_element_or_selector.replaceWith(wrapper);wrapper.append(resizable_element_or_selector);function map_style([style_key,style_value]){switch(style_key){case"maxHeight":case"max-height":return[style_key,"100%"];default:return[style_key,"revert"]}}vjs.style(resizable_element_or_selector,Object.fromEntries(Object.entries(style).map(map_style)));resizable_element_or_selector=wrapper}this.#Șdom_=resizable_element_or_selector;this.base(this);this.glue(this);this.options.direction=EnumValue.map2Array(direction,resizeDirection);this.Șdom.classList.add(this.options.classes.resizable);this.options.direction.forEach(_direction=>vjs.div({class:`${this.options.classes.handle_stem}${_direction.name}`},this.Șdom));const position=vjs.style(this.Șdom,"position");if("fixed"==position)throw new Error({msg:["param-not-match","position","fixed","param-expected","absolute/relative"]});if("absolute"!=position){kh_log.warn?.(T9`resizable may not work for ${vjs.attr(resizable_element_or_selector,"id")??resizable_element_or_selector}`)}const curRect=()=>{const cur_client_size=vjs.outerSize(this.Șdom);const cur_client_rect=new Rect({x:0,y:0,...cur_client_size});cur_client_rect.removeStyle(this.Șdom,[Rect.styleFlag.sF_padding,Rect.styleFlag.sF_border]);const cur_rect_wm=vjs.outerRect(this.Șdom,true);return new Rect({x:cur_rect_wm.x,y:cur_rect_wm.y,width:cur_client_rect.width,height:cur_client_rect.height})};vjs.onc("pointerdown",(event,handle)=>{handle??=event.target;if(0!=event.button)return;const change_horizontal=/-east|-west/.test(handle.classList.value);const change_vertical=/-north|-south/.test(handle.classList.value);const change_left=-1!=handle.classList.value.indexOf("-west");const change_right=-1!=handle.classList.value.indexOf("-east");const change_top=-1!=handle.classList.value.indexOf("-north");const change_bottom=-1!=handle.classList.value.indexOf("-south");let last_pos={x:event.clientX,y:event.clientY};const cur_rect=curRect();const maxWidth=change_horizontal&&-1!=this.options.maxWidth?Math.max(this.options.maxWidth,cur_rect.width):-1;const maxHeight=change_vertical&&-1!=this.options.maxHeight?Math.max(this.options.maxHeight,cur_rect.height):-1;const minWidth=change_horizontal&&-1!=this.options.minWidth?Math.min(this.options.minWidth,cur_rect.width):-1;const minHeight=change_vertical&&-1!=this.options.minHeight?Math.min(this.options.minHeight,cur_rect.height):-1;kh_log.trace?.(T9`pointerdown@${Resizable.flag} last_pos(${last_pos}), cur Rect({${cur_rect.x}, ${cur_rect.width}})`);const othis=this;function onresize(event){const{clientX:x,clientY:y}=event;const cur_rect=curRect();const new_rect=DOMRect.fromRect(cur_rect);let delta={x:change_right?x-last_pos.x:last_pos.x-x,y:change_bottom?y-last_pos.y:last_pos.y-y};if(change_left){new_rect.x-=delta.x}new_rect.width+=delta.x;if(change_top){new_rect.y-=delta.y}new_rect.height+=delta.y;kh_log.trace?.(T9`onresize last_pos(${last_pos}) <==> cur Mouse(${{x,y}}), delta Mouse({${delta.x},${delta.y}}), `+T9`lastRect({${cur_rect.x}, ${cur_rect.y}, ${cur_rect.width}, ${cur_rect.height}}) => newRect({${new_rect.x}, ${new_rect.y}, ${new_rect.width}, ${new_rect.height}})`);last_pos={x,y};if(-1!=maxWidth&&new_rect.width>maxWidth)return false;if(-1!=maxHeight&&new_rect.height>maxHeight)return false;if(-1!=minWidth&&new_rect.width<minWidth)return false;if(-1!=minHeight&&new_rect.height<minHeight)return false;const style={};if(change_horizontal){style.left=`${new_rect.left}px`;style.right="revert";style.width=`${new_rect.width}px`}if(change_vertical){style.top=`${new_rect.top}px`;style.bottom="revert";style.height=`${new_rect.height}px`}vjs.style(othis.Șdom,style)}vjs.on(`pointermove.${this.#ns_}`,onresize,window);vjs.one(`pointerup.${this.#ns_}`,event=>{kh_log.trace?.(T9`event ${event.type} received`);vjs.off(`.${this.#ns_}`,undefined,undefined)},window);event.stopImmediatePropagation();return false},this.Șdom,`[class*="${this.options.classes.handle_stem}"]:not(.${this.options.classes.resizable})`)}get Șdom(){return this.#Șdom_}get options(){return this.#options_}}kh_global.LoadedScripts.get(mf).resolve(ms);