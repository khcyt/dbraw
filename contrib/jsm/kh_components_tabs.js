const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof kh_global.window&&"undefined"===typeof kh_global.process&&kh_global.self;const cf="kh_components";const mf="kh_components_tabs_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof kh_global.window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof kh_global.process?"node.js":"undefined"!==typeof kh_global.self?kh_global.self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);import{isValid,isEmpty,isString}from"/contrib/jsm/kh_earlybird.js";import{Error,JSON8MergePatch}from"/contrib/jsm/kh_classes.js";const name=MF`${mf}`;const print_level=undefined;import{Logger}from"/contrib/jsm/kh_log.js";const kh_log=new Logger(print_level,()=>name);import{vjs}from"/contrib/jsm/kh_vanilla.js";import{Component,class_from_orient,class_pretty}from"/contrib/jsm/kh_components_base.js";class TabsComponent extends Component{static flag="tabs";base(component_base){if(isValid(component_base)&&!(component_base instanceof Tabs))throw new Error({msg:["invalid-argument","menu",arguments[0]]});return super.base(component_base)}}function arr_access(array,index){return!isValid(index)?array:array?.at(index)}export class Tabs extends TabsComponent{#Ștabs_element_;#options_;constructor(tabs_element,{classes={tabs_element:"tabs-element",tab_list:"tab-list",tab:"tab",tab_panel:"tab-panel"},roles={tabs:"tabs",list:"tablist",tab:"tab",panel:"tabpanel"},direction="horizontal"}={}){super();this.#options_=JSON8MergePatch.apply({classes,roles,direction},arguments[1]??{});this.#Ștabs_element_=vjs(tabs_element,true)[0];if(!isValid(this.#Ștabs_element_))throw new Error({msg:["invalid-argument","tabs_element"]});this.glue(this);this.base(this);this.role(this.#options_.roles.tabs);this.#Ștabs_element_.classList.add(this.#options_.classes.tabs_element,class_from_orient("vertical"==this.#options_.direction?"horizontal":"vertical"));let list;if("UL"!=this.#Ștabs_element_.children[0]?.tagName||!(vjs.data(this.#Ștabs_element_.children[0],"tabs")instanceof Tabs.List)){list=new Tabs.List(this)}else{vjs.empty(this.#Ștabs_element_.children[0]);list=this.list();list.base(this)}const Șpanels=this.Șpanels;Șpanels.forEach((panel_element,index)=>{const tab=new Tabs.Tab(list,{index});const panel=new Tabs.Panel(this,panel_element,tab)});vjs.onc("click",(event,li)=>{li??=event.target;const tab=this.glue(li);if(isValid(tab))list.active(tab)},this.#Ștabs_element_.children[0],"li")}get Șdom(){return this.#Ștabs_element_}get Șlist(){return this.Șdom?.children[0]}get Șpanels(){if(isValid(this.options.panels_selector)){if(isString(this.options.panels_selector))return vjs(this.Șdom,this.options.panels_selector,true);else if(Function.isFunction(this.options.panels_selector))return this.options.panels_selector(this)}return[...this.Șdom.children].filter(child=>"UL"!==child.tagName)}get options(){return this.#options_}get size(){return this.list().Șlis?.length??-1}list(){return this.glue(this.Șdom.children[0])}all_panels(index){return arr_access([...this.Șpanels].map(panel_element=>this.glue(panel_element)),index)}all_tabs(index){return arr_access(this.list().all_tabs(),index)}insertTab(index=-1,Șpanel){if(0>index||this.size<index)index=this.size;const adjacent_insert_pos=0==index?"beforebegin":"afterend";const Șli_before=this.list().Șlis[0==index?index:index-1];const Șpanel_before=this.Șpanels?.[0==index?index:index-1];Șpanel??=vjs.create("div");Șpanel_before.insertAdjacentElement(adjacent_insert_pos,Șpanel);const panel=new Tabs.Panel(this,Șpanel);const tab=new Tabs.Tab(this.list(),{index,insert_in_dom:false},panel);Șli_before.insertAdjacentElement(adjacent_insert_pos,tab.Șdom);this._trigger("inserted",{tab,panel});return tab}removeTab(tab_or_index,remove_page=true){if(!(tab_or_index instanceof Tabs.Tab))tab_or_index=this.all_tabs(tab_or_index);if(!(tab_or_index instanceof Tabs.Tab))return;const Șli=tab_or_index.Șdom;const Șpanel=remove_page?tab_or_index.Șpanel:undefined;this._trigger("removed",{tab:tab_or_index,panel:isValid(Șpanel)?this.glue(Șpanel):undefined});Șli?.remove();Șpanel?.remove()}active(tab_or_index){if(isValid(tab_or_index)&&!(tab_or_index instanceof Tabs.Tab))tab_or_index=this.all_tabs(tab_or_index);return this.list().active(tab_or_index)?.index}_trigger(event_name,data,async=true){return vjs[async?"postEvent":"sendEvent"](`${Tabs.flag}${event_name}`,this.base().Șdom,data)}static List=class _List extends TabsComponent{#Șdom_;constructor(tabs){super();if(!isValid(tabs))throw new Error({msg:["invalid-argument","tabs"]});this.base(tabs);this.#Șdom_=vjs.create("ul",{class:`${this.options.classes.tab_list} ${class_from_orient(this.options.direction)} kh-not-grow kh-align-center`});this.glue(this);this.base().Șdom.prepend(this.#Șdom_);this.role(this.options.roles.list);vjs.style(this.#Șdom_,{flexGrow:0})}active(tab){const curTabs=this.all_tabs();if(isValid(tab)){if(!(tab instanceof Tabs.Tab))throw new Error({msg:["invalid-argument","tab",tab]});const oldTab=this.active();{vjs.class(this.base().Șpanels,{active:null});vjs.class(this.Șlis,{active:null});vjs.attr(this.Șlis,{ariaSelected:false})}tab.setActive(true);const data={oldTab,oldPanel:oldTab?.panel(),newTab:tab,newPanel:tab.panel()};this.base()._trigger("activated",data)}else{return curTabs.find(cTab=>cTab.isActive())}}get Șdom(){return this.#Șdom_}get Șlis(){return vjs(this.Șdom,`li[role="${this.options.roles.tab}"]`,true)}all_tabs(){return this.Șlis?.map(li=>this.glue(li))}};static Tab=class _Tab extends TabsComponent{#Șdom_;#list_;#panel_;constructor(list,{title,index=-1,id,insert_in_dom=true},panel){super();if(!isValid(list))throw new Error({msg:["invalid-argument","list"]});this.base(list.base());this.#list_=list;id??=Function.isFunction(this.options.id_getter)?this.options.id_getter(this,index):undefined;this.#Șdom_=vjs.create("li",{class:`${this.options.classes.tab}${0==index?" active":""}`,id},insert_in_dom?list.Șdom:undefined);const btn=vjs.create("button",undefined,this.#Șdom_);if(isEmpty(title)&&!isValid(panel)){const panel_element=this.Șpanel;title=panel_element?.getAttribute("title")||panel_element?.getAttribute("data-title")||`Tab#${this.index+1}`}const label=vjs.create("label",{text:title},btn);this.glue(this);this.role(this.options.roles.tab);if(isValid(panel))this.connect(panel)}setActive(set){if(set){this.Șdom.classList.add("active");vjs.attr(this.Șdom,{ariaSelected:true});this.Șpanel.classList.add("active")}else{this.Șdom.classList.remove("active");vjs.attr(this.Șdom,{ariaSelected:null});this.Șpanel.classList.remove("active")}}isActive(){return this.Șdom.classList.contains("active")}get Șdom(){return this.#Șdom_}get Șpanel(){return this.panel()?.Șdom??this.base().Șpanels?.[this.index]}get index(){return this.base().all_tabs().findIndex(tab=>this==tab)}list(){return this.#list_}panel(){return this.#panel_??this.base().all_panels(this.index)}get#Șbutton(){return vjs(this.#Șdom_,"button",false)}get#Șlabel(){return vjs(this.#Șdom_,"label",false)}toggleHidden(){this.#Șdom_.classList.toggle("hidden")}setHidden(hidden){if(false==hidden)this.#Șdom_.classList.remove("hidden");else this.#Șdom_.classList.add("hidden")}get isHidden(){return this.#Șdom_.classList.contains("hidden")}connect(panel,relay=true){if(panel==this.#panel_||isValid(panel)&&!(panel instanceof Tabs.Panel))return;const old_panel=this.#panel_;this.#panel_=panel;if(isValid(old_panel)&&relay)old_panel.connect(undefined,false);if(isValid(this.#panel_)&&relay)this.#panel_.connect(this,false);this.#Șlabel.textContent=panel?.title??`Tab #${this.index}`}};static Panel=class _Panel extends TabsComponent{#Șdom_;#tab_;constructor(tabs,panel_element,tab){super();this.#Șdom_=panel_element;if(!isValid(tabs))throw new Error({msg:["invalid-argument","tabs"]});this.base(tabs.base());this.glue(this);this.role(this.options.roles.panel);this.#Șdom_.classList.add(...class_pretty([this.options.classes.tab_panel,0==this.index?"active":""],false));if(isValid(tab))this.connect(tab);const id=Function.isFunction(this.options.id_getter)?this.options.id_getter(this,this.index):undefined;if(isValid(id))this.Șdom.setAttribute("id",id)}get Șdom(){return this.#Șdom_}get index(){if(isValid(this.#tab_))return this.#tab_.index;else return this.base().Șpanels?.findIndex(panel=>this.Șdom==panel)??-1}get title(){return this.Șdom.getAttribute("title")||this.Șdom.getAttribute("data-title")||`Tab#${this.index+1}`}tab(){return this.#tab_??this.base().all_tabs(this.index)}connect(tab,relay=true){if(tab==this.#tab_||isValid(tab)&&!(tab instanceof Tabs.Tab))return;const old_tab=this.#tab_;this.#tab_=tab;if(isValid(old_tab)&&relay)old_tab.connect(undefined,false);if(isValid(this.#tab_)&&relay)this.#tab_.connect(this,false)}}}kh_global.LoadedScripts.get(mf).resolve(ms);