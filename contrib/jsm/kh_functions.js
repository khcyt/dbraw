const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof kh_global.window&&"undefined"===typeof kh_global.process&&kh_global.self;const cf="kh_js";const mf="kh_functions_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof kh_global.window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof kh_global.process?"node.js":"undefined"!==typeof kh_global.self?kh_global.self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);import{isValid,isEmpty,isObject,isNode,getTypeName,isString,isNumber,isPlainObject,currentFunctionName,can_rex_lookahead,isEvent,Deferred,isiOS,isjQuery,isZK}from"/contrib/jsm/kh_earlybird.js";const name=MF`${mf}`;const print_level=undefined;import{Logger}from"/contrib/jsm/kh_log.js";const kh_log=new Logger(print_level,()=>name);kh_global.showSaveFilePicker??="undefined"!==typeof window&&(await import("/cdn/native-file-system-adapter/src/es6.js"))?.showSaveFilePicker;export function getSize(obj){return Object.getOwnPropertyNames(obj).length;let size=0;for(let key in obj){if(obj.hasOwnProperty(key))++size}return size}export function for_in(obj,f,_this=obj){if(!isValid(obj)||!Function.isFunction(f))return;const direct=null==Object.getPrototypeOf(obj);for(let key in obj){if(direct||obj.hasOwnProperty(key))f.call(_this,key,obj[key])}}export function find_in(obj,f,_this=obj){if(!Function.isFunction(f))return;for(let key in obj){if(key!="webkitStorageInfo"&&obj.hasOwnProperty(key))if(f.call(_this,key,obj[key]))return key}return undefined}export function removeEmpty(obj){for_in(obj,(key,value)=>{if(isObject(value))removeEmpty(value);else if(!isValid(value))delete obj[key]});return obj}export function cloneObject(obj,{use_keys=true,transfer}={}){const m=new WeakMap;function inner_clone(o){try{if(!isValid(o))return o;if(-1!==(transfer?.indexOf?.(o)??-1))return o;const tyn=getTypeName(o);if(Function.isFunction(o)){return o.clone()}if("symbol"==typeof o)return o;if("IncomingMessage"==tyn)return o;if("OutgoingMessage"==tyn)return o;if(o instanceof RegExp)return new RegExp(o);if(o instanceof Date)return new Date(o.getTime());if("AbortSignal"==tyn||"AbortController"==tyn)return o;if(isString(o)||isNumber(o)||"boolean"==typeof o)return JSON.parse(JSON.stringify(o));if("ImageData"==tyn)return new ImageData(o.data,o.width,o.height);if(isjQuery(o))return kh_global.$(o);if(Array.isArray(o))return o.map(inner_clone);if(o instanceof Map)return new Map([...o].map(entry=>[inner_clone(entry[0]),inner_clone(entry[1])]));if(o instanceof Set)return new Set([...o].map(inner_clone));let ret=m.get(o);if(isValid(ret))return ret;if(Function.isFunction(o["clone"]))return o.clone();if(!isPlainObject(o)){try{ret=new o.constructor}catch(error){ret=Object.create(Object.getPrototypeOf(o))}}if(undefined==ret||null==ret)ret={};m.set(o,ret);const keys=use_keys?Object.keys(o):Object.getOwnPropertyNames(o);keys.forEach(k=>ret[k]=inner_clone(o[k]));return ret}catch(error){kh_log.error?.(T9`error in ${currentFunctionName()} => ${error}`);return undefined}}return inner_clone(obj)}export function cloneJSON(o,reviver){return JSON.parse(JSON.stringify(o),reviver)}export function invertObject(obj,check_numeric=false){if(!isValid(obj))return obj;const make_prop=val=>isPlainObject(val)?JSON.stringify(val):val.toString();if(Array.isArray(obj)){return obj.reduce((new_obj,cur,idx)=>(new_obj[make_prop(cur)]=idx,new_obj),{})}else{const entries=Object.entries(obj);const is_numeric=check_numeric&&entries.every(entry=>isNumber(entry[1],true)&&entry[1].toString()==(entry[1]|0).toString());if(is_numeric)return entries.reduce((new_arr,cur)=>(new_arr[cur[1]|0]=cur[0],new_arr),[]);else return entries.reduce((new_obj,cur)=>(new_obj[make_prop(cur[1])]=cur[0],new_obj),{})}}export function flattenObject(obj,delim=".",keepFunctionality=false){if(!isValid(obj)||!isObject(obj))return obj;const m=new WeakMap;const ret={};function innerFlatten(o,path){if(!isEmpty(path))path+=delim;for(const[key,value]of Object.entries(o)){if(!isObject(value)||"supress"!=keepFunctionality||0==Object.entries(value).length||m.has(value)){ret[path+key]=Function.isFunction(value)?keepFunctionality?value:"ƒ()":isObject(value)?keepFunctionality?value:"{...}":value}if(isObject(value)&&!m.has(value)){m.set(value,value);innerFlatten(value,path+key)}}return ret}return innerFlatten(obj,"")}export function make_unique(array){if(isEmpty(array))return array;return Array.from(new Set(array))}export function subset(obj,...keys){if(1==keys.length&&Function.isFunction(keys[0])){return subset(obj,...Object.keys(obj).filter(k=>keys[0](k)))}return keys.reduce((a,c)=>({...a,[c]:obj[c]}),{})}export function bind_args_from_n(ƒ,n,...bound_args){return function(...args){return ƒ(...args.slice(0,n-1),...bound_args,...args.slice(n-1))}}export const bind1st=(ƒ,_1st)=>bind_args_from_n(ƒ,1,_1st);export const bind2nd=(ƒ,_2nd)=>bind_args_from_n(ƒ,2,_2nd);export const not=ƒ=>function(){return!ƒ(...arguments)};export function flipArgz(f){return(...args)=>f(...args.reverse())}export const indexOfMaxValue=(array,cmp_f)=>array.reduce((iMax,cur_val,cur_idx)=>(Function.isFunction(cmp_f)?1<=cmp_f(cur_val,array[iMax]):cur_val>array[iMax])?cur_idx:iMax,0);export const indexOfMinValue=(array,cmp_f)=>array.reduce((iMin,cur_val,cur_idx)=>(Function.isFunction(cmp_f)?-1>=cmp_f(cur_val,array[iMin]):cur_val<array[iMin])?cur_idx:iMin,0);export function shuffle_array(array){if(isEmpty(array))return array;for(let i=array.length-1;0<i;--i){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]]}return array}export function partition_array(array,filter){return array?.reduce(([pass,fail],elem,index)=>filter(elem,index)?[[...pass,elem],fail]:[pass,[...fail,elem]],[[],[]])}export function getRandomArbitrary(min=0,max){return Math.random()*((max||Number.MAX_SAFE_INTEGER||1<<31>>>0)-min)+min}let crypto="undefined"!==typeof kh_global.process?import("node:crypto").then(module=>crypto=module.default):kh_global.crypto;export function generatePassword(length=20,wishlist="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@-#$"){const randomFunc=crypto?.getRandomValues?.bind(crypto)??crypto?.getRandomValues?.bind(crypto)??(arr=>arr.map(v=>getRandomArbitrary(0,1<<31>>>0)>>>0));return Array.from(randomFunc(new Uint32Array(length))).map(x=>wishlist[x%wishlist.length]).join("")}export function romanize(num){const lookup={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};let roman="";for(let i in lookup){while(num>=lookup[i]){roman+=i;num-=lookup[i]}}return roman}export function deromanize(roman_str){const str=(roman_str||"").toUpperCase();const validator=/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/;const token=/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g;const key={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};let num=0,m;if(!(str&&validator.test(str)))return false;while(m=token.exec(str))num+=key[m[0]];return num}export function parseRange(range){const match=range?.match(/(?:\s*<\s*(\d+))|(?:(\d+)\s*-\s*(\d+))|(?:(\d+)\s*\.\.\s*(\d+))|(?:\s*>\s*(\d+))/);if(isValid(match?.[1]))return{min:Number.MIN_SAFE_INTEGER,max:+match?.[1]};if(isValid(match?.[2])||isValid(match?.[4]))return{min:+(match?.[2]??match?.[4]),max:+(match?.[3]??match?.[5])};if(isValid(match?.[6]))return{min:+match?.[6],max:Number.MAX_SAFE_INTEGER};return undefined}export function check4Field(obj,fieldname,init_value){if(!isValid(obj)||isEmpty(fieldname))return false;if(!obj.hasOwnProperty(fieldname)){let value_=undefined!==init_value?init_value:{};Object.defineProperty(obj,fieldname,{configurable:true,enumerable:true,writable:true,get(){return value_},set(v){value_=v}})}else{let descr=Object.getOwnPropertyDescriptor(obj,fieldname)}return true}export function addField(obj,fieldname,fg,fs){if(!isValid(obj))return;if(!isValid(fieldname)&&isValid(obj.obj)&&isValid(obj.fieldname)){return addField(obj.obj,obj.fieldname,obj.fg,obj.fs)}else{if(!isValid(fieldname)||obj.hasOwnProperty(fieldname))return;let methName=fieldname.charAt(0).toUpperCase()+fieldname.substring(1);obj["get"+methName]=function(){if(!check4Field(this,fieldname))return null;return null!=fg?fg.call(this):this[fieldname]};obj["set"+methName]=function(fv){if(!check4Field(this,fieldname,fv))return;null!=fs?fs.call(this,fv):this[fieldname]=fv}}}export function deferF(f,t=1e3,exclusive=false,_this=this){if(!Function.isFunction(f))return f;let timerId=-1;if(isValid(_this))f=f.bind(_this);return function(){if(exclusive&&-1!=timerId)kh_global.clearTimeout(timerId);timerId=kh_global.setTimeout(f,t,...arguments)}}if(isNode()){kh_global.setZeroTimeout=setTimeout}else{const timeouts=[];const messageName="zero-timeout-message";kh_global.setZeroTimeout=function(fn){timeouts.push(fn);kh_global.postMessage(messageName,"*")};function handleMessage(event){let _messageName=event.data;if(isValid(_messageName.key)){const topW=globalThis.top;const topStorage=topW.kh.storage["kh_vanilla"];const event_map=topStorage.PostMessageQueue_EventMap;_messageName=event_map.get(_messageName.key)}if(event.source==kh_global&&messageName==_messageName){event.stopPropagation();if(0<timeouts.length){const fn=timeouts.shift();fn()}}}addEventListener("message",handleMessage,true)}export const defer=(t,v)=>new Promise(resolve=>kh_global[0==t?"setZeroTimeout":"setTimeout"](()=>resolve(v),t));export function yieldToMain(){return defer(0)}export function toBytesUint32(num,littleEndian){const arr=new ArrayBuffer(4);const view=new DataView(arr);view.setUint32(0,num>>>0,littleEndian);return arr}export function toBytesUint64(num,littleEndian){const arr=new ArrayBuffer(8);const view=new DataView(arr);view.setBigUint64(0,"bigint"==typeof num?num:BigInt(num),littleEndian);return arr}export function toBytesUint64_s(num,littleEndian){if(num?.startsWith?.("0x"))num=num.substring(2);if(!isString(num)||16<num.length)return undefined;if(16>num.length)num="0".repeat(16-num.length)+num;const bytes=num.match(/../g).map(s=>parseInt(s,16));const arr=new ArrayBuffer(8);const i8arr=new Int8Array(arr);bytes.forEach((b,i)=>i8arr[littleEndian?bytes.length-i-1:i]=b);return arr}export const getTimestamp=function(){const has_performance=kh_global.performance&&kh_global.performance.now&&kh_global.performance.timing&&kh_global.performance.timing.navigationStart;return has_performance?function(){return kh_global.performance.now()+kh_global.performance.timing.navigationStart}:function(){return Date.now()}}();export function getTimestamp4FileName(){let tp=(new Date).toISOString();tp=tp.substring(0,tp.indexOf("."));return tp.replace("T","-").replace(/:/g,"-")}const camelizeRE=/[-_\s](\w)/g;export function toCamelCase(str){return str?.replace(camelizeRE,(_,c)=>c?c.toUpperCase():"")}function toKebabOrSnakeCase(str,join_sign,lazy=false){if(Array.isArray(str))str=str.filter(s=>!isEmpty(s)).join(join_sign);if(!isString(str))return str;if(can_rex_lookahead){if(lazy){return str.match(/[A-ZÄÖÜ]{2,}(?=[A-ZÄÖÜ][a-zäöü]+[0-9]*|\b)|[A-ZÄÖÜ]?[a-zäöü]+[0-9]*|[A-ZÄÖÜ]+|[0-9]+/g)?.map(x=>x.toLowerCase())?.join(join_sign)??str.trim(/^(?:[^a-zäöüA-ZÄÖÜ0-9]*)([a-zäöüA-ZÄÖÜ0-9]*)(?:[^a-zäöüA-ZÄÖÜ0-9]*)$/)}else{const matches=[...str.matchAll(/[A-ZÄÖÜ]{2,}(?=[A-ZÄÖÜ][a-zäöü]+[0-9]*|\b)|[A-ZÄÖÜ]?[a-zäöü]+[0-9]*|[A-ZÄÖÜ]+|[0-9]+/g)];if(isEmpty(matches))return str;return`${str.substring(0,matches[0].index)}${matches.map(match=>match[0].toLowerCase()).join(join_sign)}${str.substring(matches.at(-1).index+matches.at(-1)[0].length)}`}}else{let prefix="",postfix="";if(str.startsWith("--")){str=str.substring(2);prefix="--"}if(str.endsWith("_")){str=str.substring(0,str.length-1);postfix="_"}const ret=str?.match(/[A-ZÄÖÜ]{2,}(?=[A-ZÄÖÜ][a-zäöü]+[0-9]*|\b)|[A-ZÄÖÜ]?[a-zäöü]+[0-9]*|[A-ZÄÖÜ]+|[0-9]+/g)?.map(x=>x.toLowerCase()).join(join_sign)??str;return`${prefix}${ret}${postfix}`}}export function toKebabCase(str,lazy=false){return toKebabOrSnakeCase(str,"-",lazy)}export function toSnakeCase(str,lazy=false){return toKebabOrSnakeCase(str,"_",lazy)}export function realizeShariff(){if(!kh_global.Shariff)return;[...kh_global.document?.documentElement?.children?.[1]?.querySelectorAll(".shariff")||[]].forEach(elem=>{if(elem.hasOwnProperty("shariff"))elem.shariff=new kh_global.Shariff(elem)})}export function open_doc(url,title,options){if(isEvent(url,false)){url=url.target.href}if(isEmpty(url)||!isValid(window))return false;options||=`toolbar=${window.toolbar?.visible?"yes":"no"},location=${window.locationbar?.visible?"yes":"no"},menubar=${window.menubar?.visible?"yes":"no"},`+`scrollbars=${window.scrollbars?.visible?"yes":"no"},status=${window.statusbar.visible?"yes":"no"},resizable=yes`;const w=window.open(url,title||"_blank",options);try{w.focus()}catch(e){}return false}let sendEvent;let getWidgetFromStrOrId;if(isValid(kh_global.jq)&&isValid(kh_global.zk)){sendEvent=function(id,event="onEvent",data){if(!isValid(id))return;kh_global.zAu.send(new kh_global.zk.Event(getWidgetFromStrOrId(id),event,data,{toServer:true}),10)};getWidgetFromStrOrId=function(id,strict=false){if(!isValid(id)||!isValid(kh_global.zk))return undefined;const is_string=isString(id);const prefixed=is_string&&-1!=["#","$","@",".","["].indexOf(id.charAt(0));let wgt=is_string?kh_global.zk.Widget.$(prefixed?id:"$"+id):isZK(id)?id:kh_global.zk.Widget.$(id);if(!wgt&&true!==strict&&!prefixed)wgt=kh_global.zk.Widget.$("#"+id);return wgt}}else{sendEvent=function(){};getWidgetFromStrOrId=function(){}}export{sendEvent,getWidgetFromStrOrId};export function downloadContent2File({content,fn_stem,fn_ext,filename=`${fn_stem||"content"}_${getTimestamp4FileName()}${isEmpty(fn_ext)?"":`.${fn_ext}`}`,mime_type,node,auto_remove,auto_click,timeout=-1}={}){if(isEmpty(content))return{promise:Promise.reject("empty content")};const resultP=new Deferred(timeout);let revokeObjectURL=false;if(content instanceof Blob){content=URL.createObjectURL(content);revokeObjectURL=true}let anchor;if(Function.isFunction(node)){auto_remove=false;auto_click=false;anchor=node(filename);if(!isValid(anchor))return{promise:Promise.reject("invalid anchor")}}else{auto_remove??=!isValid(node);auto_click=auto_remove||(auto_click??=!isValid(node));anchor=document.createElement("a");const parent=auto_remove?document.body:node;anchor.href=content.startsWith("/")||content.startsWith("blob:")||content.startsWith("data:")?content:"data:attachment/text,"+encodeURI(content);anchor.download=encodeURI(filename);anchor.type=mime_type;anchor.textContent=auto_remove?"":decodeURI(filename)??"download";anchor.target="_self";parent.appendChild(anchor)}if("showSaveFilePicker"in kh_global&&!auto_remove){anchor.addEventListener("click",event=>{(()=>showSaveFilePicker({suggestedName:decodeURI(filename)??"download"}).then(async newHandle=>Promise.all([import("/contrib/jsm/kh_media.js"),newHandle.createWritable()])).then(async([{Util},writableStream])=>[await Util.getBinaryFromDataURL(content),writableStream]).then(async([blob,writableStream])=>Promise.all([writableStream.write(blob),writableStream])).then(async([_,writableStream])=>writableStream.close()).then(()=>resultP.resolve(true)).catch(error=>{const logger="AbortError"==error?.name?kh_log.debug:kh_log.error;logger?.(T9`error during showSaveFilePicker => ${error}`);return resultP.reject(error)}))();event.stopPropagation();event.preventDefault();return false});auto_click=false}else{if(isiOS()){anchor.addEventListener("click",event=>{(async()=>{import("/cdn/js-file-downloader/+esm").then(async module=>{const JsFileDownloader=module.default;return new JsFileDownloader({url:content,filename,forceDesktopMode:true,contentType:mime_type})}).then(()=>resultP.resolve(true)).catch(error=>{const logger="AbortError"==error?.name?kh_log.debug:kh_log.error;kh_log.error?.(T9`error during donwload file ${filename} => ${error}`);return resultP.reject(error)})})()})}else{anchor.addEventListener("click",event=>defer(2e3).then(()=>resultP.resolve(true)),{once:true})}}if(auto_click)anchor.click();if(auto_remove){anchor.remove();if(revokeObjectURL)URL.revokeObjectURL(content)}return{anchor:auto_remove?undefined:anchor,content:revokeObjectURL?undefined:content,promise:resultP}}export function getFile4Upload({multiple=false}={}){let input=document.createElement("input");input.setAttribute("type","file");input.setAttribute("multiple","");return new Promise(function(resolve,reject){const test_cancel=e=>{setTimeout(()=>{if(isValid(input)&&isEmpty(input.value)){kh_log.debug?.("cancel for input element pressed");input.remove();input=undefined;reject("cancel")}},250);document.body.onfocus=null};input.onclick=e=>{document.body.onfocus=test_cancel};input.onchange=e=>{if(!isValid(input)){debugger;return reject("undefined")}const result=multiple?input.files:input.files[0];input.remove();input=undefined;kh_log.debug?.("onchange event for input element processed");resolve(result)};input.click()})}export function getFileContent4Upload({multiple=false,content_type="text",encoding="utf8",files}={}){if(isValid(files))multiple=Array.isArray(files)||files instanceof FileList;return(!isValid(files)?getFile4Upload({multiple}):Promise.resolve(files)).then(file_s=>{file_s=Array.isArray(files)?files:files instanceof FileList?Array.from(file_s):[file_s];const p_file_s=file_s.map(file=>new Promise((resolve,reject)=>{let reader=new FileReader;switch(content_type){case"dataurl":reader.readAsDataURL(file);break;case"binarystring":reader.readAsBinaryString(file);break;case"arraybuffer":reader.readAsArrayBuffer(file);break;default:reader.readAsText(file,encoding);break}reader.onload=event=>resolve(event.target.result);reader.onerror=event=>reject(event.type)}));return Promise.all(p_file_s).then(content_s=>Promise.resolve(multiple?content_s:content_s[0]))}).catch(error=>Promise.reject(error))}export async function blobToBase64(blob){const reader=new FileReader;reader.readAsDataURL(blob);return new Promise((resolve,reject)=>{reader.onloadend=()=>{resolve(reader.result)}})}export function getAttribute2(id_from,attr_name,id_recv,event,what="css"){let dom_from="prop"==what&&isZK(id_from)?id_from:(kh_global.kh.storage.kh_zk?.getDOMObjectNativeFromStr??document.querySelector.bind(document))(id_from);if(!isValid(dom_from)||isEmpty(attr_name))return;const jq=kh_global.jq||kh_global.$;const get_what=function(name){let value="css"==what?!isValid(jq)?window.getComputedStyle(dom_from).getPropertyValue(name):jq(dom_from).css(name):"attr"==what?!isValid(jq)?dom_from.getAttribute(name):jq(dom_from).attr(name):dom_from[name];if(isValid(value)||"prop"!==what)return value;if("zk"in kh_global&&!isZK(dom_from)){dom_from=getWidgetFromStrOrId(id_from);value=dom_from?.[name];if(isValid(value))return value}else if(isjQuery(dom_from)){dom_from=dom_from.get(0);value=dom_from?.[name]}else value=dom_from?.[name];return value};attr_name=Array.isArray(attr_name)?attr_name:[attr_name];const ret=Object.fromEntries(attr_name.map(_attr_name=>{const value=get_what(_attr_name);return isValid(value)?[_attr_name,value]:undefined}).filter(entry=>isValid(entry)));if(kh_global.zk){const wgt_recv=getWidgetFromStrOrId(id_recv??id_from);if(wgt_recv){kh_log.trace?.("send event for property get: ",attr_name,"  -> ",JSON.stringify(ret));sendEvent(wgt_recv,event||"onGetAttribute",JSON.stringify(ret))}}return ret}export function getClientPosition(id,id_recv,event){if(!id)return;let xPos=0;let yPos=0;while(id){if(id.tagName=="BODY"){let xScroll=id.scrollLeft||document.documentElement.scrollLeft;let yScroll=id.scrollTop||document.documentElement.scrollTop;xPos+=id.offsetLeft-xScroll+id.clientLeft;yPos+=id.offsetTop-yScroll+id.clientTop}else{xPos+=id.offsetLeft-id.scrollLeft+id.clientLeft;yPos+=id.offsetTop-id.scrollTop+id.clientTop}id=id.offsetParent}let pos={x:xPos,y:yPos};if("zk"in kh_global){let recv=getWidgetFromStrOrId(id_recv);if(recv)sendEvent(recv,event||"onClientPosition",JSON.stringify(pos))}return pos}export function getDOMEvent(event,strict=false){event=event.originalEvent??event.srcEvent??event.domEvent??event;return!strict||event instanceof Event?event:undefined}export function testPopupEnabled(){return new Promise(function(resolve,reject){const test=window.open(undefined,"","width=1,height=1");setTimeout(function(){if((test?.innerHeight??0)>0){test?.close();resolve()}else reject()},20)})}export function CryptMailto(mailaddress,shift){if(isEmpty(mailaddress))return"";if(mailaddress instanceof URL)mailaddress=mailaddress.toString();else if(!mailaddress.startsWith("mailto:"))mailaddress="mailto:"+mailaddress;let encrypted_mailaddress="";for(let i=0;i<mailaddress.length;++i){let n=mailaddress.charCodeAt(i);if(8364<=n)n=128;encrypted_mailaddress+=String.fromCharCode(n+shift)}return encrypted_mailaddress}export function UnCryptMailto(encrypted_mailaddress,shift){if(isEmpty(encrypted_mailaddress))return"";let mailaddress="";for(let i=0;i<encrypted_mailaddress.length;++i){let n=encrypted_mailaddress.charCodeAt(i);if(8364<=n)n=128;mailaddress+=String.fromCharCode(n-shift)}return mailaddress}export function linkTo_UnCryptMailto(encrypted_mailaddress,shift){if(encrypted_mailaddress.startsWith(`${kh_global.location.origin}/`))encrypted_mailaddress=encrypted_mailaddress.substring(kh_global.location.origin.length+1);encrypted_mailaddress=encrypted_mailaddress.replace(/^\/?#?(.*)/,"$1");const ma=UnCryptMailto(encrypted_mailaddress,shift||4);const a=document.createElement("a");a.href=ma;document.body.appendChild(a);a.click();document.body.removeChild(a)}export function String2ByteString(string){if(isEmpty(string))return string;return string.split("").map(c=>c.charCodeAt(0).toString(16).padStart(2,"0")).join("")}export function ByteString2String(bytestring){if(isEmpty(bytestring)||0!==bytestring.length%2)return bytestring;const string_buf=[];for(let i=0;i<bytestring.length/2;++i){string_buf.push(parseInt(bytestring.substring(i*2,i*2+2),16))}return Buffer2String(string_buf)}export function ByteString2Buffer(bytestring){if(isEmpty(bytestring)||0!==bytestring.length%2)return undefined;const string_buf=[];for(let i=0;i<bytestring.length/2;++i){string_buf.push(parseInt(bytestring.substring(i*2,i*2+2),16))}return Uint8Array.from(string_buf)}export function String2Buffer(string,encoding="utf8"){return Uint8Array.from(string,c=>c.charCodeAt(0))}export function Buffer2String(buffer){if(isEmpty(buffer))return"";if(isNode()&&buffer instanceof kh_global.Buffer)buffer=new Uint8Array(buffer);if(!isNode()&&buffer instanceof ArrayBuffer)buffer=new Uint8Array(buffer);return[...buffer].map(n=>String.fromCodePoint(n)).join("")}export function Buffer2ByteString(buffer){if(isEmpty(buffer))return"";if(isNode()&&buffer instanceof kh_global.Buffer)buffer=new Uint8Array(buffer);return[...buffer].map(n=>n.toString(16).padStart(2,"0")).join("")}export function bytes2ArrayBuffer(bytes){return Uint8Array.from(bytes).buffer}export class WindowArgs{static get align(){return"align"}static get arg(){return"arg"}static get argz(){return"argz"}static get audio(){return"audio"}static get auditor(){return"auditor"}static get auto(){return"auto"}static get bgc(){return"bgc"}static get classz(){return"class"}static get command(){return"command"}static get component(){return"component"}static get content(){return"content"}static get data(){return"data"}static get db(){return"db"}static get def(){return"def"}static get disabled(){return"disabled"}static get distribute(){return"distribute"}static get draggable(){return"draggable"}static get droppable(){return"dropable"}static get each(){return"each"}static get embedded(){return"embedded"}static get entries(){return"entries"}static get event(){return"event"}static get fgc(){return"fgc"}static get font(){return"font"}static get forward(){return"forward"}static get grouping(){return"grouping"}static get header(){return"header"}static get height(){return"height"}static get horizontal(){return"horizontal"}static get html(){return"html"}static get icon(){return"icon"}static get id(){return"id"}static get iframe(){return"iframe"}static get ignore(){return"ignore"}static get image(){return"image"}static get imagemap(){return"imagemap"}static get include_url(){return"include_url"}static get key(){return"key"}static get locale(){return"locale"}static get label(){return"label"}static get label_key(){return WindowArgs.label+"_"+WindowArgs.key}static get lvc_parent(){return"lvc_"+WindowArgs.parent}static get map(){return"map"}static get menu(){return"menu"}static get message(){return"message"}static get method(){return"method"}static get mime(){return"mime"}static get mobile(){return"mobile"}static get mode(){return"mode"}static get model(){return"model"}static get multiline(){return"multiline"}static get name(){return"name"}static get _native(){return"native"}static get open(){return"open"}static get orient(){return"orient"}static get paramz(){return"paramz"}static get parent(){return"parent"}static get pdf(){return"pdf"}static get position(){return"position"}static get prompt(){return"prompt"}static get popup(){return"popup"}static get reference(){return"reference"}static get rows(){return"rows"}static get sclass(){return"sclass"}static get script(){return"script"}static get secure(){return"secure"}static get selective(){return"selective"}static get selector(){return"selector"}static get sizable(){return"sizable"}static get special(){return"special"}static get style(){return"style"}static get tc(){return"tc"}static get template(){return"template"}static get text(){return"text"}static get themer(){return"themer"}static get title(){return"title"}static get tooltip(){return"tt"}static get type(){return"type"}static get uuid(){return"uuid"}static get url(){return"url"}static get user(){return"user"}static get vertical(){return"vertical"}static get visible(){return"visible"}static get ui_model(){return"ui_model"}static get value(){return"value"}static get value_def(){return"value_def"}static get value_each(){return"value_each"}static get video(){return"video"}static get vm(){return"vm"}static get wargz(){return"wargz"}static get width(){return"width"}static get xhtml(){return"xhtml"}static get xml(){return"xml"}static get zul(){return"zul"}static ƒdata(...ss){return[WindowArgs.data,...ss].join("_")}static get uim_doc_tree(){return"uim_doc_tree"}static get uim_group_details(){return"uim_group_details"}static get uim_group_list(){return"uim_group_list"}static get uim_iframe(){return"uim_iframe"}static get uim_input(){return"uim_input"}static get uim_list(){return"uim_list"}static get uim_menu(){return"uim_menu"}static get uim_menu_item(){return"uim_menu_item"}static get uim_onto_tree(){return"uim_onto_tree"}static get uim_row(){return"uim_row"}static get uiu_disabled(){return"uiu_"+WindowArgs.disabled}static get uiu_visible(){return"uiu_"+WindowArgs.visible}static get uiu_style(){return"uiu_"+WindowArgs.style}static get uiu_type(){return"uiu_type"}static get uiu_ignore(){return"uiu_"+WindowArgs.ignore}static get evtGeoLocation(){return"onGeoLocation"}static get evtScriptLoad(){return"onScriptLoad"}static get evtScriptFail(){return"onScriptFail"}static get evtUIUpdate(){return"onUIUpdate"}static get evtSetDimension(){return"onSetDimension"}static get evtClientAttribute(){return"onClientAttribute"}static get evtClientDimension(){return"onClientDimension"}static get evtHistoryMark(){return"onHistoryMark"}}export function makeAnimationLoop(func,intervall){let last_animation=-1;intervall=false==intervall?intervall:isNumber(intervall,true)?intervall|0:1e3;return function loop(timepoint){if(false==intervall||-1==last_animation||intervall<timepoint-last_animation){const diff_time=-1!=last_animation?timepoint-last_animation:100;const ret=func(timepoint,diff_time);if("break"===ret)return;if(false!==ret)last_animation=timepoint}return requestAnimationFrame(loop)}(kh_global.performance.now())}export function requestTick(t_u){if(!isValid(t_u)||!Function.isFunction(t_u.updater))return;if(true!=t_u.ticker)requestAnimationFrame(()=>t_u.updater(t_u));t_u.ticker=true}export function directStickies(selector,attr){document.querySelectorAll(selector||".sticky")?.forEach(elem=>{elem.classList.remove("sticky");attr||=";position:sticky;";elem.setAttribute("style",(elem.getAttribute("style")??"")+attr)})}export async function downloadFile(src,mime,dest){if(undefined!==mime&&(null===mime||null!==mime&&0==mime.length))mime="none";import("/contrib/js/ext_download.js").then(module=>kh_global.download(src,dest,mime))}export function minify_json(json_data,{json_path,filter_key,filter_value,as_string=true}={}){if(isString(json_data)){try{json_data=JSON.parse(json_data)}catch(error){json_data=undefined}}if(!isEmpty(json_path)){if(!isEmpty(json_data)){return import(`/cdn/jsonpath-plus/dist/index-${isNode()?"node":"browser"}-esm.js`).then(async({JSONPath:jp})=>{const res_arr=jp({resultType:"all",path:json_path,json:json_data,callback:entry=>delete entry.parent[entry.parentProperty]});return as_string?JSON.stringify(json_data):json_data})}else{json_data={};return Promise.resolve(as_string?JSON.stringify(json_data):json_data)}}else{if(!isEmpty(json_data)){filter_key=!isEmpty(filter_key)?new RegExp(filter_key):undefined;filter_value=!isEmpty(filter_value)?new RegExp(filter_value):undefined;json_data=JSON.stringify(json_data,function(key,value){if(true==filter_key?.test(key))return undefined;if(true==filter_value?.test(value))return undefined;return value},0)}else json_data="{}";return as_string?json_data:JSON.parse(json_data)}}export function getWorkerScriptURL(url,baseURL){if(isEmpty(url))return url;const isBlob=url instanceof Blob;if(!isValid(kh_global.importShim)){return isBlob?url:url instanceof URL?url.href:url}else{const module_shim=getWorkerScriptURL.shim_lib(false);const import_map=JSON.stringify(kh_global.importShim.getImportMap());const worker_string1=`\n\t\t\t((async function() {\n\t\t\t\tconst _as_module= undefined== this;\n\t\t\t\tself.esmsInitOptions= JSON.parse('${JSON.stringify(kh_global.esmsInitOptions)}');\n\t\t\t\t// url hier ohne geschweifte Klammern Dollar{}, damit wir den url-Parameter der Funktion erwischen\n\t\t\t\tself.esmsInitOptions.meta= function (metaObj, url) {\n\t\t\t\t\tconst queryPos= url.indexOf('?');\n\t\t\t\t\tself.query= -1!= queryPos ? url.substring(queryPos, url.length) : undefined;\n\t\t\t\t};\n\t\t\t\tif (_as_module) await import('${module_shim}');\n\t\t\t\telse importScripts('${module_shim}');\n\t\t\t\tfalse && console.log('${import_map}');\n\t\t\t\timportShim.addImportMap(${import_map});\n\t\t`;const worker_string2=isBlob?url:`\n\t\t\t\timportShim('${new URL(url,baseURL).href}').catch(error => setTimeout(() => { throw error; }))`;const worker_string3=`\n\t\t\t})())\n\t\t\t// .then(() => console.log('worker loading via importShim() finished'))\n\t\t\t.catch(error => console.log('worker via importShim() chrashed', error));\n\t\t`;const blob=new Blob([worker_string1,worker_string2,worker_string3],{type:"application/javascript"});return URL.createObjectURL(blob)}}getWorkerScriptURL.shim_lib=function(CSP=true){return`https://cdn.jsdelivr.net/npm/es-module-shims@2.0.3/dist/es-module-shims${CSP?"":".wasm"}.js`};Object.assign(cs,{deferF,defer,open_doc,realizeShariff,getAttribute2,directStickies,downloadFile,toKebabCase,cloneObject,Buffer2String,String2Buffer});kh_global.LoadedScripts.get(mf).resolve(ms);