const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof kh_global.window&&"undefined"===typeof kh_global.process&&kh_global.self;const cf="kh_vanilla";const mf="kh_vanilla2_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof kh_global.window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof kh_global.process?"node.js":"undefined"!==typeof kh_global.self?kh_global.self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);import{isValid,isEmpty,isDOMElement,getBrowserLang,setBrowserLang,isMobile,isTouch,isPromise,getBrowserShort,getOSShort,pdfViewerEnabled,isPlainObject,currentFunctionName,logicalXOR}from"/contrib/jsm/kh_earlybird.js";import{StringMap,Error}from"/contrib/jsm/kh_classes.js";import{requestTick,getAttribute2,yieldToMain,CryptMailto,downloadContent2File}from"/contrib/jsm/kh_functions.js";import{vjs}from"/contrib/jsm/kh_vanilla.js";const name=MF`${mf}`;const print_level=undefined;import{Logger}from"/contrib/jsm/kh_log.js";const kh_log=new Logger(print_level,()=>name);cs.strings??=function(){const vjs_sm=new StringMap({"vjs-switch-flag":"data-kh-switch","style.status.text":"","id.app.status":"app-status"});StringMap.getGlobalMap().addEntries(vjs_sm);return vjs_sm}();CSSRule;function handle_css_switch_on(force=false){if(force||!isValid(cs["css-switch-on-value"])){const def_switch_on=800;let switch_on=Number.parseInt(vjs.cssvar(vjs.body,"--orient-switch"))||def_switch_on;if(def_switch_on!=switch_on){function replace_switch_on(new_switch_on,old_switch_on){let new_switch_on_px=`${new_switch_on}px`;const old_switch_on_px=`${old_switch_on}px`;const no_replace=".kh-no-replace";[...document.styleSheets].forEach(ss=>{try{[...ss.cssRules||[]].filter(rule=>isValid(rule.media)&&-1!=rule.media.mediaText.indexOf(old_switch_on_px)&&-1==[...rule.cssRules||[]].findIndex(css_rule=>-1!=css_rule.selectorText.indexOf(no_replace))).forEach(rule=>{rule.media.mediaText=rule.media.mediaText.replace(old_switch_on_px,`${new_switch_on_px}`)})}catch(error){kh_log.trace?.(`can't access CSS from ${ss.href} => ${error}`)}})}replace_switch_on(switch_on,def_switch_on);replace_switch_on(switch_on+1,def_switch_on+1)}cs["css-switch-on-value"]=switch_on}return cs["css-switch-on-value"]}const C={get orient_switch_handler(){return cs["orient-switch-handler"]},set orient_switch_handler(value){cs["orient-switch-handler"]=value},get orient_switch_width(){return cs["orient-switch-handler-width"]},set orient_switch_width(value){cs["orient-switch-handler-width"]=value}};export function install_resize_handler(){if(!isValid(C.orient_switch_handler)){const switch_on=handle_css_switch_on();C.orient_switch_handler=(event,fake)=>{if(!C.orient_switch_width||logicalXOR(C.orient_switch_width<=switch_on,kh_global.innerWidth<=switch_on)){const switch_flag=kh_global.kh.storage.kh_js.unzipString("vjs-switch-flag");const switch_value=kh_global.innerWidth<=switch_on?"vertical":"horizontal";vjs.html.setAttribute(switch_flag,switch_value);if(!fake)vjs.trigger(switch_flag,window,{switch_value})}C.orient_switch_width=kh_global.innerWidth};const vhw_setter=t_u=>{const vh=Math.min(window.innerHeight,window.outerHeight)*.01;const vw=Math.min(window.innerWidth,window.outerWidth)*.01;vjs.cssvar(vjs.html,"--vh",`${vh}px`);vjs.cssvar(vjs.html,"--vw",`${vw}px`);t_u.ticker=false};const vhw_ticker={ticker:false,updater:vhw_setter};vjs.on("resize",event=>{C.orient_switch_handler(event,false);requestTick(vhw_ticker)},window);C.orient_switch_handler(null,true);vhw_setter(vhw_ticker)}}export function install_resize_handler_v2(){if(true!==CSS.supports("width:100dvw"))return install_resize_handler();if(!isValid(C.orient_switch_handler)){C.orient_switch_handler=function(event,fake=false){const switch_flag=kh_global.kh.storage.kh_js.unzipString("vjs-switch-flag");const switch_value=event.matches?"vertical":"horizontal";vjs.html.setAttribute(switch_flag,switch_value);if(!fake)vjs.trigger(switch_flag,window,{switch_value})};const switch_on=handle_css_switch_on();const mql=window.matchMedia(`(max-width:${switch_on}px)`);mql.addEventListener("change",C.orient_switch_handler);C.orient_switch_handler({matches:kh_global.innerWidth<=switch_on},true)}}export async function onReadyStd(app_context,{string_tables=[],app_lang,force_secure=true,irh_flag=true,logger=kh_log}={}){if(false!==force_secure&&"https:"!==kh_global.location.protocol){kh_global.location.replace(`https:${kh_global.location.href.substring(location.protocol.length)}`)}if(isValid(app_context)){app_context.subRoute??=(()=>{const pn=window.location.pathname;return 1<=pn.length&&pn.endsWith("/")?pn.substring(0,pn.length-1):pn})();app_context.setStatus??=function(text,cat="err",delay_clear=1e4){let Șstatus=vjs(`#${app_context.unzip?.("id.app.status")??"status.bar"}`);if(isEmpty(Șstatus))return;if(Array.isArray(Șstatus))Șstatus=Șstatus[0];text||="???";if(Array.isArray(text))Șstatus.append(...text);else if(isDOMElement(text))Șstatus.append(text);else Șstatus.innerText=T9`${text}`;logger["err"==cat?"error":"wrn"==cat?"warn":"info"]?.(T9`status: ${text}`);Șstatus.setAttribute("class",(app_context.unzip?.("class.app.status.stem")??"")+cat);if(-1!=delay_clear)kh_global.setTimeout(()=>{vjs.empty(Șstatus);Șstatus.setAttribute("class","")},delay_clear)}}string_tables.forEach(string_table=>StringMap.getGlobalMap().addEntries(string_table));let browser_lang=getBrowserLang({query:"html",attribute:"lang"});kh_log.assert?.(browser_lang==getAttribute2("html","lang",undefined,undefined,"attr")?.["lang"],"must-be-equal","getLanguage() results");if(isValid(app_lang))setBrowserLang({query:"html",attribute:"lang",lang:app_lang});StringMap.getGlobalMap().afterLocale();vjs.html.setAttribute("data-mobile",isMobile()?"1":"0");vjs.html.setAttribute("data-touch",isTouch()?"1":"0");vjs.html.setAttribute("data-browser",getBrowserShort());vjs.html.setAttribute("data-os",getOSShort());vjs.html.setAttribute("data-pdfve",pdfViewerEnabled()?"1":"0");if(false!=irh_flag)install_resize_handler_v2()}export function NodeFromTemplate(template_name,as_string=false){try{if(isEmpty(template_name)){const p=document.createElement("p");p.textContent=`template name - ${kh_global.kh.storage.kh_js.unzipString("param-not-determined")}`;return!as_string?p:p.outerHTML}try{let Ștemplate=vjs(`${template_name.startsWith("#")?"":"#"}${template_name}`,false);if(isValid(Ștemplate))return!as_string?[...Ștemplate.content.children].map(c=>c.cloneNode(true)):Ștemplate.innerHTML;else{const p=document.createElement("p");p.textContent=`template - ${template_name} - ${kh_global.kh.storage.kh_js.unzipString("invalid-argument")}`;return!as_string?[p]:p.outerHTML}}catch(error){debugger}}finally{yieldToMain().then(()=>handle_css_switch_on(true))}}export class Elements{static fromPhone(phones,sep="-",nnbsp=" "){if(isEmpty(phones))return undefined;if(!Array.isArray(phones))phones=[phones];const parentNode=1<phones.length?document.createElement("div"):undefined;if(isValid(parentNode)){parentNode.classList.add("kh-vlayout");vjs.cssvar(parentNode,"--gap-v","0")}const phone_nodes=phones.map(phone=>{const div=vjs.div({class:{"kh-hlayout":true,"kh-not-grow":true}});const p=vjs.p({text:`☎`},div);const a=vjs.a({href:`tel:${phone.split(sep).join("")}`,text:phone.split(sep).join(nnbsp),dataType:"phone"},div);return div});if(isValid(parentNode)){phone_nodes.forEach(pn=>parentNode.insertAdjacentElement("beforeend",pn));return parentNode}else return phone_nodes[0]}static fromMailAddress(mailaddresses,crypt_shift,nnbsp=" "){if(isEmpty(mailaddresses))return undefined;if(!Array.isArray(mailaddresses))mailaddresses=[mailaddresses];const parentNode=1<mailaddresses.length?document.createElement("div"):undefined;if(isValid(parentNode)){parentNode.classList.add("kh-vlayout");vjs.cssvar(parentNode,"--gap-v","0")}const mailaddress_nodes=mailaddresses.map(mailaddress=>{const div=vjs.div({class:{"kh-hlayout":true,"kh-not-grow":true}});const p=vjs.p({text:`✉`},div);let visible_mailaddress=mailaddress;try{let mail_url=mailaddress;if(!(mail_url instanceof URL)){if(!mail_url.startsWith("mailto:"))mail_url=`mailto:${mail_url}`;mail_url=new URL(mail_url)}visible_mailaddress=`${mail_url.pathname}`;mailaddress=mail_url}catch(error){kh_log.warn?.(T9`${new Error({msg:["param-invalid","mail-address",mailaddress],cause:error})}`)}const a=vjs.a({href:CryptMailto(mailaddress,crypt_shift),text:visible_mailaddress.split("").join(nnbsp),dataType:"mail"},div);return div});if(isValid(parentNode)){mailaddress_nodes.forEach(pn=>parentNode.insertAdjacentElement("beforeend",pn));return parentNode}else return mailaddress_nodes[0]}}export function MousePos2Client(event,element=event.target){const rect=element.getBoundingClientRect();const mp=vjs.MousePos(event);return{x:mp.x-rect.left,y:mp.y-rect.top}}export function getHtml4Download(selector,filename){const elements=vjs(selector);if(isEmpty(elements))return;const content=elements.map(elem=>elem.textContent).join("\n");return downloadContent2File({content,filename})}export function createHtmlTable({table_opt,header=true,body=true,footer=true,parent}={}){const table=vjs.create("table",table_opt,parent);function createStructure(name,opt,with_row=true,parent=table){const structure_element=vjs.create(name,isPlainObject(opt)?opt:undefined,parent);if(with_row){vjs.create("td",undefined,vjs.create("tr",undefined,structure_element))}return structure_element}if(true==header||isPlainObject(header))createStructure("thead",header,true);if(true==body||isPlainObject(body))createStructure("tbody",body,true);if(true==footer||isPlainObject(footer))createStructure("tfoot",footer,true);return table}export function startViewTransition(callback,value){if(!isValid(document.startViewTransition)){const updateCallbackDone=new Promise((resolve,reject)=>{try{const result=callback(value);if(isPromise(result))result.then(r=>resolve(r)).catch(error=>reject(error));else resolve(result)}catch(error){reject(error)}});return{ready:Promise.resolve(true),updateCallbackDone,finished:updateCallbackDone.then(()=>true),skipTransition(){return Promise.reject(new Error({msg:["invalid-operation","skipTransition"]}))}}}else{return document.startViewTransition(async()=>{try{const result=await callback(value);return result}catch(error){kh_log.error?.(T9`error in startViewTransition callback / ${currentFunctionName()} / => ${error}`);throw error}})}}export function getTextEntent({text,fontFamily,fontSize="1em"}={}){if(isEmpty(text))return undefined;const canvas=vjs.create("canvas");const ctxt=canvas.getContext("2d");ctxt.font=`${fontSize} ${fontFamily}`;return ctxt.measureText(text)}Object.assign(cs,{});kh_global.LoadedScripts?.get(mf).resolve(ms);