const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof kh_global.window&&"undefined"===typeof kh_global.process&&kh_global.self;const cf="kh_web";const mf="kh_web_html_tooltip_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof kh_global.window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof kh_global.process?"node.js":"undefined"!==typeof kh_global.self?kh_global.self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);import{isEmpty,isTouch,isValid}from"/contrib/jsm/kh_earlybird.js";import{WindowArgs}from"/contrib/jsm/kh_functions.js";const name=MF`${mf}`;const print_level=undefined;import{Logger}from"/contrib/jsm/kh_log.js";const kh_log=new Logger(print_level,()=>name);import{vjs}from"/contrib/jsm/kh_vanilla.js";import{info}from"/contrib/jsm/kh_components_popup.js";export const tooltip={class_icon:"kh-icon-tooltip",class_icon_auto:"kh-tooltip-auto",class_text:"kh-text-texttip",class_text_auto:"kh-texttip-auto",auto_create(base){base=vjs(base);if(isEmpty(base))return;const class_icon_auto=tooltip.class_icon_auto;const class_icon_auto_after=`${tooltip.class_icon_auto}-after`;const class_icon_auto_before=`${tooltip.class_icon_auto}-before`;const attr_title=WindowArgs.title;const attr_title_after=`data-${WindowArgs.title}-after`;const attr_title_before=`data-${WindowArgs.title}-before`;let Ștts=vjs(base,`[class*=${class_icon_auto}][${attr_title}]:not([${attr_title}=""])`,true);Ștts.push(...vjs(base,`[class*=${class_icon_auto_after}][${attr_title}]:not([${attr_title}=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${class_icon_auto_after}][${attr_title_after}]:not([${attr_title_after}=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${class_icon_auto_before}][${attr_title}]:not([${attr_title}=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${class_icon_auto_before}][${attr_title_before}]:not([${attr_title_before}=""])`,true)??[]);Ștts.forEach((elem,idx)=>{const title=elem.getAttribute(attr_title);let title_after=elem.getAttribute(attr_title_after);let title_before=elem.getAttribute(attr_title_before);if(isEmpty(title)&&isEmpty(title_after)&&isEmpty(title_before))return;const classz=[...elem.classList].filter(c=>c.startsWith(class_icon_auto));if(isEmpty(classz))return;if(elem.classList.contains("direct")){elem.classList.add(tooltip.class_icon);classz.forEach(c=>{switch(c){case class_icon_auto_before:{title_before||=!isEmpty(title_after)||!elem.classList.contains(class_icon_auto_after)&&!elem.classList.contains(class_icon_auto)?title:undefined;if(!isEmpty(title_before)){elem.classList.add("before");elem.setAttribute("data-title-before",title_before)}break}case class_icon_auto_after:case class_icon_auto:{title_after||=title;if(!isEmpty(title_after)){elem.classList.add("after");elem.setAttribute("data-title-after",title_after)}break}default:throw`kh - invalid tooltip text action ${c}`}});elem.setAttribute(WindowArgs.title,title_after??title_before??title??"")}else{const new_parent=vjs.div({style:vjs.style(elem)??""});elem.before(new_parent);new_parent.append(elem);elem.setAttribute("style","");classz.forEach(c=>{let insert_position="beforebegin";let tip=title;const span=document.createElement("span");switch(c){case class_icon_auto_after:{title_after||=!isEmpty(title_before)||!elem.classList.contains(class_icon_auto_before)&&!elem.classList.contains(class_icon_auto)?title:undefined;if(!isEmpty(title_after)){insert_position="afterend";tip=title_after}break}case class_icon_auto_before:case class_icon_auto:{title_before||=title;if(!isEmpty(title_before)){tip=title_before}break}default:throw`kh - invalid tooltip action ${c}`}elem.insertAdjacentElement(insert_position,span);span.setAttribute(WindowArgs.title,tip??"");span.classList.add(tooltip.class_icon)});elem.setAttribute(WindowArgs.title,title_before??title_after??title??"")}elem.classList.remove(...classz);let data_class=elem.getAttribute("data-class")?.split(" ");if(!isEmpty(data_class)){classz.forEach(cl=>{const index=data_class.indexOf(cl);if(-1!=index)data_class.splice(index,1)});elem.setAttribute("data-class",data_class.join(" "))}});vjs.onc("pointerdown",(event,tt_target)=>{if(isValid(tt_target)&&event.target!=tt_target)return;tt_target??=event.target;info({message:event.target.getAttribute(WindowArgs.title),options:{duration:"PT5S"},logger:kh_log})},base,`[class*="${tooltip.class_icon}"]`)},auto_create_text(base){if(!isTouch())return;base=vjs(base);if(isEmpty(base))return;const class_text_auto=tooltip.class_icon_auto;const class_text_auto_after=`${tooltip.class_text_auto}-after`;const class_text_auto_before=`${tooltip.class_text_auto}-before`;const attr_title=WindowArgs.title;const attr_title_after=`data-${WindowArgs.title}-after`;const attr_title_before=`data-${WindowArgs.title}-before`;let Ștts=vjs(base,`[class*=${class_text_auto}][${attr_title}]:not([${attr_title}=""])`,true);Ștts.push(...vjs(base,`[class*=${class_text_auto_after}][${attr_title}]:not([${attr_title}=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${class_text_auto_after}][${attr_title_after}]:not([${attr_title_after}=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${class_text_auto_before}][${attr_title}]:not([${attr_title}=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${class_text_auto_before}][${attr_title_before}]:not([${attr_title_before}=""])`,true)??[]);Ștts=Ștts.filter(Ștt=>vjs.isVisible(Ștt));Ștts.forEach((elem,idx)=>{const title=elem.getAttribute(attr_title);let title_after=elem.getAttribute(attr_title_after);let title_before=elem.getAttribute(attr_title_before);if(isEmpty(title)&&isEmpty(title_after)&&isEmpty(title_before))return;const classz=[...elem.classList].filter(c=>c.startsWith(class_text_auto));if(isEmpty(classz))return;if(elem.classList.contains("direct")){elem.classList.add(tooltip.class_text);classz.forEach(c=>{let tip=title;switch(c){case class_text_auto_before:{title_before||=!isEmpty(title_after)||!elem.classList.contains(class_text_auto_after)&&!elem.classList.contains(class_text_auto)?title:undefined;if(!isEmpty(title_before)){elem.classList.add("before");elem.setAttribute("data-title-before",title_before)}break}case class_text_auto_after:case class_text_auto:{title_after||=title;if(!isEmpty(title_after)){elem.classList.add("after");elem.setAttribute("data-title-after",title_after)}break}default:throw`kh - invalid tooltip text action ${c}`}})}else{const new_parent=vjs.div({style:vjs.style(elem)??""});elem.before(new_parent);new_parent.append(elem);elem.setAttribute("style","");new_parent.classList.add("kh-vlayout");classz.forEach(c=>{let insert_position="beforebegin";let tip=title;const span=document.createElement("span");switch(c){case class_text_auto_after:{title_after||=!isEmpty(title_before)||!elem.classList.contains(class_text_auto_before)&&!elem.classList.contains(class_text_auto)?title:undefined;if(!isEmpty(title_after)){insert_position="afterend";tip=title_after}break}case class_text_auto_before:case class_text_auto:{title_before||=title;if(!isEmpty(title_before)){tip=title_before}break}default:throw`kh - invalid tooltip text action ${c}`}elem.insertAdjacentElement(insert_position,span);span.setAttribute(WindowArgs.title,tip);span.classList.add(tooltip.class_text)});elem.setAttribute(WindowArgs.title,title_before??title_after??title??"")}elem.classList.remove(...classz);let data_class=elem.getAttribute("data-class")?.split(" ");if(!isEmpty(data_class)){classz.forEach(cl=>{const index=data_class.indexOf(cl);if(-1!=index)data_class.splice(index,1)});elem.setAttribute("data-class",data_class.join(" "))}})}};Object.assign(cs,{tooltip});kh_global.LoadedScripts.get(mf).resolve(ms);